<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Manage Matches</title>
  <link rel="stylesheet" href="admin-bet.css">
  <style>
    .goal-controls button {
      padding: 2px 8px;
      margin: 0 2px;
    }
    .score {
      font-weight: bold;
      margin: 0 5px;
    }
    .status.live { color: red; font-weight: bold; }
    .status.off { color: gray; }
    .status.open { color: green; }
    .status.closed { color: orange; }
    .status.finished { color: blue; }
    .actions button {
      margin: 2px;
      padding: 4px 8px;
      font-size: 12px;
    }
    .btn-live { background: #ff4444; color: white; }
    .btn-close { background: #ffaa00; color: white; }
    .btn-finish { background: #0088cc; color: white; }
    .btn-edit { background: #00aa00; color: white; }
    .btn-delete { background: #cc0000; color: white; }

    /* Edit Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
    }
    .modal-content {
      background: white;
      margin: 5% auto;
      padding: 20px;
      width: 80%;
      max-width: 600px;
      border-radius: 10px;
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .close-modal {
      background: #cc0000;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="top-buttons">
      <h2>‚öΩ Admin - Manage Matches</h2>
      <button onclick="window.location='admin-bet-history.html'">üìú View Bet History</button>
    </div>

    <!-- Upload Match -->
    <label>Home Team</label>
    <input id="home" placeholder="Enter Home team" />

    <label>Away Team</label>
    <input id="away" placeholder="Enter Away team" />

    <label>Date</label>
    <input id="date" type="date" />

    <label>Time</label>
    <input id="time" type="time" />

    <!-- 1X2 Market -->
    <div class="section">
      <h3>1X2 Odds</h3>
      <div class="odds-grid">
        <input id="home_odd" placeholder="Home (1)" />
        <input id="draw_odd" placeholder="Draw (X)" />
        <input id="away_odd" placeholder="Away (2)" />
      </div>
    </div>

    <!-- GG / NG -->
    <div class="section">
      <h3>GG / NG (Both Teams to Score)</h3>
      <div class="odds-grid">
        <input id="gg_yes" placeholder="GG Yes Odd" />
        <input id="gg_no" placeholder="GG No Odd" />
      </div>
    </div>

    <!-- Over/Under -->
    <div class="section">
      <h3>Over / Under Goals</h3>
      <div class="odds-grid">
        <input id="over_1_5" placeholder="Over 1.5" />
        <input id="under_1_5" placeholder="Under 1.5" />
        <input id="over_2_5" placeholder="Over 2.5" />
        <input id="under_2_5" placeholder="Under 2.5" />
        <input id="over_3_5" placeholder="Over 3.5" />
        <input id="under_3_5" placeholder="Under 3.5" />
        <input id="over_4_5" placeholder="Over 4.5" />
        <input id="under_4_5" placeholder="Under 4.5" />
      </div>
    </div>

    <button class="btn-main" onclick="uploadMatch()">Upload Match</button>
    <p id="message"></p>

    <!-- Uploaded Matches -->
    <div class="history">
      <h3>üìã Uploaded Matches</h3>
      <table>
        <thead>
          <tr>
            <th>Match</th>
            <th>Date</th>
            <th>Score</th>
            <th>Live</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="matchBody">
          <tr><td colspan="6">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Match Odds</h3>
        <button class="close-modal" onclick="closeEditModal()">‚úñ Close</button>
      </div>
      <div id="editForm"></div>
      <button class="btn-main" onclick="saveEditedMatch()">üíæ Save Changes</button>
      <button class="btn-close" onclick="closeEditModal()">‚ùå Cancel</button>
    </div>
  </div>

<script>
  const API_BASE = "https://gaming-continental.onrender.com/api/match";
  const BET_API_BASE = "https://gaming-continental.onrender.com/bets";
  let currentEditMatchId = null;

  // ‚úÖ No token, no auth ‚Äî clean headers
  function getHeaders() {
    return { "Content-Type": "application/json" };
  }

  async function uploadMatch() {
    const msg = document.getElementById("message");
    msg.innerHTML = "";

    const odds = {
      "1X2": {
        home: parseFloat(document.getElementById("home_odd").value) || 1.5,
        draw: parseFloat(document.getElementById("draw_odd").value) || 1.5,
        away: parseFloat(document.getElementById("away_odd").value) || 1.5
      },
      "GG/NG": {
        yes: parseFloat(document.getElementById("gg_yes").value) || 1.5,
        no: parseFloat(document.getElementById("gg_no").value) || 1.5
      },
      "O/U": {}
    };

    const lines = [1.5, 2.5, 3.5, 4.5];
    lines.forEach(line => {
      const overVal = document.getElementById(`over_${line.toString().replace('.', '_')}`).value;
      const underVal = document.getElementById(`under_${line.toString().replace('.', '_')}`).value;
      if (overVal) odds["O/U"][`over_${line}`] = parseFloat(overVal);
      if (underVal) odds["O/U"][`under_${line}`] = parseFloat(underVal);
    });

    const payload = {
      home: document.getElementById("home").value.trim(),
      away: document.getElementById("away").value.trim(),
      date: document.getElementById("date").value,
      time: document.getElementById("time").value,
      odds,
      isLive: false
    };

    if (!payload.home || !payload.away) {
      msg.innerText = "‚ùå Please enter both team names";
      return;
    }

    try {
      const res = await fetch(`${API_BASE}/create`, {
        method: "POST",
        headers: getHeaders(),
        body: JSON.stringify(payload)
      });
      const data = await res.json();

      if (res.ok) {
        msg.innerText = "‚úÖ Match uploaded successfully!";
        clearForm();
        await loadMatches();
      } else {
        msg.innerText = "‚ùå " + (data.error || "Upload failed");
      }
    } catch (err) {
      msg.innerText = "‚ö†Ô∏è Connection error: " + err.message;
    }
  }

  function clearForm() {
    document.querySelectorAll("input").forEach(i => i.value = "");
  }

  async function loadMatches() {
    const body = document.getElementById("matchBody");
    body.innerHTML = "<tr><td colspan='6'>Loading...</td></tr>";

    try {
      const res = await fetch(`${API_BASE}`);
      const matches = await res.json();
      const list = Array.isArray(matches) ? matches : [];

      if (!list.length) {
        body.innerHTML = "<tr><td colspan='6'>No matches yet.</td></tr>";
        return;
      }

      body.innerHTML = "";
      list.forEach(m => {
        body.innerHTML += `
          <tr>
            <td><strong>${m.home}</strong> vs <strong>${m.away}</strong></td>
            <td>${m.date || ''} ${m.time || ''}</td>
            <td class="goal-controls">
              <span class="score">${m.homeGoals ?? 0}</span> - <span class="score">${m.awayGoals ?? 0}</span>
            </td>
            <td><span class="status ${m.isLive ? 'live' : 'off'}">${m.isLive ? "LIVE" : "OFF"}</span></td>
            <td><span class="status ${m.status}">${m.status || 'open'}</span></td>
            <td class="actions">
              <button class="btn-delete" onclick="deleteMatch('${m._id}')">üóëÔ∏è Delete</button>
            </td>
          </tr>`;
      });
    } catch (err) {
      body.innerHTML = `<tr><td colspan='6' style="color:red;">Error: ${err.message}</td></tr>`;
    }
  }

  async function deleteMatch(id) {
    if (!confirm("Are you sure you want to delete this match?")) return;
    try {
      const res = await fetch(`${API_BASE}/${id}`, {
        method: "DELETE",
        headers: getHeaders()
      });
      if (res.ok) {
        alert("‚úÖ Deleted successfully");
        await loadMatches();
      } else {
        alert("‚ùå Failed to delete match");
      }
    } catch (err) {
      alert("‚ö†Ô∏è Error deleting: " + err.message);
    }
  }

  document.addEventListener("DOMContentLoaded", loadMatches);
</script>
</body>
</html>