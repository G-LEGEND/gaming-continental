<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: white;
      margin: 0;
      padding: 20px;
    }

    .center {
      max-width: 1000px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 25px;
      color: gold;
    }

    /* Admin Navigation */
    .admin-nav {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
      gap: 20px;
      justify-items: center;
      margin-bottom: 30px;
    }

    .admin-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      cursor: pointer;
      background: transparent;
      border: none;
    }

    .admin-btn .circle {
      width: 65px;
      height: 65px;
      border-radius: 50%;
      background: gold;
      box-shadow: 0 0 12px gold, 0 0 25px rgba(255,215,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      margin-bottom: 6px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .admin-btn:hover .circle {
      transform: scale(1.1);
      box-shadow: 0 0 18px gold, 0 0 35px rgba(255,215,0,0.9);
    }

    .admin-btn span {
      color: white;
      font-size: 13px;
    }

    /* Summary */
    .summary-card {
      background: #1e293b;
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 18px;
      color: #f8fafc;
      box-shadow: 0 0 10px rgba(255,215,0,0.3);
    }

    /* Table */
    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #1e293b;
      border-radius: 8px;
      overflow: hidden;
      color: #f8fafc;
    }

    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #334155;
    }

    th {
      background: #0f172a;
      font-weight: bold;
    }

    tr:hover {
      background: #334155;
    }

    .muted {
      color: #9ca3af;
      font-size: 12px;
    }

    .logout-btn {
      background: #dc2626;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      margin-bottom: 20px;
      font-weight: bold;
    }

    .logout-btn:hover {
      background: #b91c1c;
    }

    .admin-info {
      background: #1e293b;
      padding: 10px 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      text-align: center;
      color: #9ca3af;
    }

    @media (max-width: 600px) {
      th, td {
        font-size: 12px;
        padding: 8px;
      }
      h1 {
        font-size: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="center">
    <h1>‚öúÔ∏è Admin Dashboard</h1>

    <!-- Admin Info -->
    <div class="admin-info" id="adminInfo">
      Loading...
    </div>

    <!-- Logout Button -->
    <button class="logout-btn" onclick="logoutAdmin()">üö™ Logout</button>

    <!-- Navigation -->
    <div class="admin-nav">
      <button class="admin-btn" onclick="goPage('admin-dashboard.html')">
        <div class="circle">üè†</div><span>Dashboard</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-account.html')">
        <div class="circle">üë§</div><span>Accounts</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-bet.html')">
        <div class="circle">üé≤</div><span>Bets</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-deposit.html')">
        <div class="circle">üí≥</div><span>Deposits</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-payment-method.html')">
        <div class="circle">üè¶</div><span>Payment</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-withdraw.html')">
        <div class="circle">üèß</div><span>Withdrawals</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-live.html')">
        <div class="circle">üé¶</div><span>YouTube</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-tournament.html')">
        <div class="circle">üéÆ</div><span>Tournaments</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-rank.html')">
        <div class="circle">üìä</div><span>Ranking</span>
      </button>
      <button class="admin-btn" onclick="goPage('admin-livescores.html')">
        <div class="circle">üì∫</div><span>Live Scores</span>
      </button>
      <button class="admin-btn" onclick="goPage('settings.html')">
        <div class="circle">‚öôÔ∏è</div><span>Settings</span>
      </button>
    </div>

    <!-- Summary -->
    <div class="summary-card">
      üåç Total User Balance: <span id="totalBalance">Loading...</span>
    </div>

    <!-- User Table -->
    <div class="table-container">
      <table id="usersTable">
        <thead>
          <tr>
            <th>#</th>
            <th>User ID</th>
            <th>Nickname</th>
            <th>Email</th>
            <th>Balance (‚Ç¶)</th>
            <th>Rank</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const API_BASE = "https://gaming-continental.onrender.com";

    // ‚úÖ Simple session check without tokens
    function checkAdminSession() {
      const isLoggedIn = localStorage.getItem("adminLoggedIn");
      const adminEmail = localStorage.getItem("adminEmail");
      
      console.log("üîç Checking admin session:");
      console.log("adminLoggedIn:", isLoggedIn);
      console.log("adminEmail:", adminEmail);
      
      if (!isLoggedIn || !adminEmail) {
        console.log("‚ùå No admin session found, redirecting to login");
        alert("Please login as admin first");
        window.location.href = "admin.html";
        return false;
      }
      
      console.log("‚úÖ Admin session valid");
      return true;
    }

    function goPage(page) {
      if (!checkAdminSession()) return;
      window.location.href = page;
    }

    function logoutAdmin() {
      localStorage.removeItem("adminLoggedIn");
      localStorage.removeItem("adminEmail");
      window.location.href = "admin.html";
    }

    function updateAdminInfo() {
      const adminEmail = localStorage.getItem("adminEmail");
      const adminInfoEl = document.getElementById("adminInfo");
      
      if (adminEmail) {
        adminInfoEl.textContent = `Logged in as: ${adminEmail}`;
        adminInfoEl.style.color = "#4ade80";
      } else {
        adminInfoEl.textContent = "Not logged in";
        adminInfoEl.style.color = "#f87171";
      }
    }

    async function loadUsers() {
      // Check session first
      if (!checkAdminSession()) return;

      try {
        console.log("üì° Loading users from API...");
        
        // ‚úÖ FIXED: Remove Authorization header since we're not using tokens
        const res = await fetch(`${API_BASE}/user/all`);

        if (!res.ok) {
          throw new Error(`Failed to load users: ${res.status}`);
        }

        const users = await res.json();
        const tbody = document.querySelector("#usersTable tbody");
        tbody.innerHTML = "";

        console.log("‚úÖ Users loaded:", users);

        let total = 0;
        
        if (!users || users.length === 0) {
          tbody.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; color: #9ca3af;">
                No users found
              </td>
            </tr>
          `;
          document.getElementById("totalBalance").textContent = "‚Ç¶0";
          return;
        }

        users.forEach((u, i) => {
          total += u.balance || 0;
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${i + 1}</td>
            <td class="muted">${u._id ? u._id.substring(0, 8) + '...' : 'N/A'}</td>
            <td>${u.nickname || "‚Äî"}</td>
            <td>${u.email || "‚Äî"}</td>
            <td>‚Ç¶${(u.balance || 0).toLocaleString()}</td>
            <td>${u.rank || "-"}</td>
          `;
          tbody.appendChild(tr);
        });

        document.getElementById("totalBalance").textContent = 
          `‚Ç¶${total.toLocaleString()}`;

      } catch (err) {
        console.error("‚ùå Failed to load users:", err);
        document.getElementById("totalBalance").textContent = "Error loading data";
        
        const tbody = document.querySelector("#usersTable tbody");
        tbody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; color: #f87171;">
              Error loading users: ${err.message}
            </td>
          </tr>
        `;
      }
    }

    document.addEventListener("DOMContentLoaded", function() {
      console.log("üöÄ Admin dashboard loaded");
      
      // Check session on page load
      if (!checkAdminSession()) return;
      
      // Update admin info display
      updateAdminInfo();
      
      // Load users
      loadUsers();
    });
  </script>
</body>
</html>