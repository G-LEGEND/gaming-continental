<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Live Streams - Gaming Continental</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      padding-bottom: 80px;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px 16px;
      border-bottom-left-radius: 24px;
      border-bottom-right-radius: 24px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      text-align: center;
      margin-bottom: 24px;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #2d3748;
      margin-bottom: 4px;
    }

    .welcome-text {
      color: #718096;
      font-size: 0.9rem;
    }

    /* Main Container */
    .center { 
      padding: 0 16px;
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }

    /* Video Player */
    .video-container {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 16px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      margin-bottom: 20px;
      position: relative;
    }

    .video-player {
      width: 100%;
      height: 220px;
      border-radius: 12px;
      background: #000;
    }

    .now-playing {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .now-playing-badge {
      background: #dc2626;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
    }

    .video-title {
      font-weight: 600;
      color: #2d3748;
      font-size: 1rem;
      margin-top: 12px;
      line-height: 1.3;
    }

    .video-controls {
      display: flex;
      gap: 10px;
      margin-top: 12px;
    }

    .control-btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .control-btn:active {
      transform: translateY(2px);
    }

    .next-btn {
      background: #4f46e5;
      color: white;
    }

    .fullscreen-btn {
      background: #6b7280;
      color: white;
    }

    /* Streams Container */
    .streams-container {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 32px;
    }

    /* Stream Card */
    .stream-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }

    .stream-card:active {
      transform: scale(0.98);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .stream-title {
      font-weight: 600;
      color: #2d3748;
      font-size: 1.1rem;
      margin-bottom: 12px;
    }

    .stream-description {
      color: #718096;
      font-size: 0.9rem;
      margin-bottom: 16px;
      line-height: 1.4;
    }

    .watch-btn {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      color: white;
      padding: 14px 20px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
      display: block;
      text-align: center;
      width: 100%;
      border: none;
      cursor: pointer;
    }

    .watch-btn:active {
      transform: translateY(2px);
      box-shadow: 0 2px 8px rgba(79, 70, 229, 0.3);
    }

    .live-badge {
      background: #dc2626;
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 700;
      display: inline-block;
      margin-bottom: 12px;
    }

    /* No Streams State */
    .no-streams {
      text-align: center;
      padding: 60px 20px;
      color: #718096;
    }

    .no-streams i {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.5;
      display: block;
    }

    .no-streams h3 {
      font-size: 1.2rem;
      margin-bottom: 8px;
      color: #2d3748;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: #718096;
    }

    .loading-spinner {
      border: 3px solid #e2e8f0;
      border-top: 3px solid #4f46e5;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Bottom Navigation */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255, 255, 255, 0.2);
      display: flex;
      justify-content: space-around;
      padding: 12px 16px;
      box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
    }

    .nav-tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 8px 12px;
      border-radius: 12px;
      transition: all 0.3s ease;
      cursor: pointer;
      min-width: 60px;
    }

    .nav-tab:active {
      background: rgba(79, 70, 229, 0.1);
      transform: scale(0.95);
    }

    .nav-tab.active {
      background: rgba(79, 70, 229, 0.1);
    }

    .tab-icon {
      font-size: 1.5rem;
      margin-bottom: 4px;
      transition: all 0.3s ease;
    }

    .nav-tab.active .tab-icon {
      transform: scale(1.1);
      color: #4f46e5;
    }

    .tab-label {
      font-size: 0.7rem;
      font-weight: 600;
      color: #4a5568;
    }

    .nav-tab.active .tab-label {
      color: #4f46e5;
    }

    /* Admin Link */
    .admin-link {
      text-align: center;
      margin-top: 20px;
    }

    .admin-link a {
      color: #4f46e5;
      font-weight: 600;
      text-decoration: none;
      font-size: 0.9rem;
    }

    /* Fullscreen styles */
    .fullscreen-mode {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 1000;
      display: none;
    }

    .fullscreen-video {
      width: 100%;
      height: 100%;
    }

    .exit-fullscreen {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
      cursor: pointer;
      z-index: 1001;
    }

    /* Responsive adjustments */
    @media (max-width: 480px) {
      .stream-card {
        padding: 16px;
      }
      
      .header h1 {
        font-size: 1.4rem;
      }
    }

    @media (min-width: 768px) {
      .center {
        max-width: 400px;
      }
      
      .bottom-nav {
        max-width: 400px;
        margin-left: auto;
        margin-right: auto;
        border-radius: 20px 20px 0 0;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        width: calc(100% - 40px);
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <h1>üî¥ Live Streams</h1>
    <div class="welcome-text">Watch live gaming tournaments in real-time</div>
  </div>

  <!-- Main Content -->
  <div class="center">
    <!-- Video Player Section -->
    <div class="video-container" id="videoContainer" style="display: none;">
      <div class="now-playing">
        <div class="now-playing-badge">üî¥ NOW PLAYING</div>
      </div>
      <div id="videoPlayer" class="video-player"></div>
      <div class="video-title" id="currentVideoTitle"></div>
      <div class="video-controls">
        <button class="control-btn next-btn" onclick="playNextStream()">‚ñ∂Ô∏è Next Stream</button>
        <button class="control-btn fullscreen-btn" onclick="enterFullscreen()">‚õ∂ Fullscreen</button>
      </div>
    </div>

    <!-- Streams List -->
    <div class="streams-container" id="streamsList">
      <!-- Streams will be loaded here -->
    </div>


  <!-- Fullscreen Mode -->
  <div class="fullscreen-mode" id="fullscreenMode">
    <button class="exit-fullscreen" onclick="exitFullscreen()">‚úï</button>
    <div id="fullscreenVideo" class="fullscreen-video"></div>
  </div>

  <!-- Bottom Navigation -->
  <div class="bottom-nav">
    <div class="nav-tab" data-page="dashboard.html">
      <div class="tab-icon">üè†</div>
      <div class="tab-label">Home</div>
    </div>
    <div class="nav-tab" data-page="tournament.html">
      <div class="tab-icon">üéÆ</div>
      <div class="tab-label">Tournament</div>
    </div>
    <div class="nav-tab active" data-page="live.html">
      <div class="tab-icon">üî¥</div>
      <div class="tab-label">Live</div>
    </div>
    <div class="nav-tab" data-page="account.html">
      <div class="tab-icon">üë§</div>
      <div class="tab-label">Account</div>
    </div>
  </div>

  <!-- YouTube IFrame API -->
  <script>
    const API_BASE = window.location.origin;
    let currentStreamIndex = 0;
    let player;
    let fullscreenPlayer;
    let streams = [];

    // Load YouTube IFrame API
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    const firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // YouTube player ready callback
    function onYouTubeIframeAPIReady() {
      loadStreams();
    }

    // Load streams from MongoDB backend
    async function loadStreams() {
      const list = document.getElementById("streamsList");
      
      // Show loading state
      list.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          <div>Loading live streams...</div>
        </div>
      `;

      try {
        const response = await fetch(`${API_BASE}/livestream`);
        
        if (!response.ok) {
          throw new Error('Failed to fetch streams');
        }
        
        streams = await response.json();
        
        // Hide video player if no streams
        if (streams.length === 0) {
          document.getElementById('videoContainer').style.display = 'none';
          if (player) {
            player.stopVideo();
          }
        }
        
        displayStreams(streams);
        
        // Auto-play the first stream if available and no video is currently playing
        if (streams.length > 0 && (!player || player.getPlayerState() === -1 || player.getPlayerState() === 0 || player.getPlayerState() === 5)) {
          setTimeout(() => {
            playStream(0);
          }, 1000);
        }
        
      } catch (err) {
        console.error("Error loading streams:", err);
        showNoStreams();
      }
    }

    function displayStreams(streams) {
      const list = document.getElementById("streamsList");
      
      if (!streams || streams.length === 0) {
        showNoStreams();
        return;
      }

      list.innerHTML = '<h3 style="margin-bottom: 16px; color: #2d3748;">Available Streams</h3>';
      
      streams.forEach((stream, index) => {
        const streamCard = document.createElement("div");
        streamCard.className = "stream-card";
        streamCard.innerHTML = `
          <div class="live-badge">üî¥ LIVE NOW</div>
          <div class="stream-title">${stream.tournament}</div>
          <div class="stream-description">${stream.description}</div>
          <button class="watch-btn" onclick="playStream(${index})">
            üì∫ Play This Stream
          </button>
        `;
        list.appendChild(streamCard);
      });
    }

    function showNoStreams() {
      const list = document.getElementById("streamsList");
      list.innerHTML = `
        <div class="no-streams">
          <i>üî¥</i>
          <h3>No Live Streams</h3>
          <p>There are no active streams right now</p>
          <p style="margin-top: 16px; font-size: 0.9rem;">
            Check back later or 
        
          </p>
        </div>
      `;
    }

    function playStream(index) {
      if (!streams[index]) return;
      
      currentStreamIndex = index;
      const stream = streams[index];
      
      // Show video container
      document.getElementById('videoContainer').style.display = 'block';
      document.getElementById('currentVideoTitle').textContent = stream.tournament;
      
      // Scroll to video
      document.getElementById('videoContainer').scrollIntoView({ behavior: 'smooth' });
      
      // Extract YouTube video ID
      const videoId = extractYouTubeId(stream.link);
      
      if (videoId) {
        // Create or update player
        if (player) {
          player.loadVideoById(videoId);
        } else {
          player = new YT.Player('videoPlayer', {
            height: '220',
            width: '100%',
            videoId: videoId,
            playerVars: {
              'autoplay': 1,
              'controls': 1,
              'rel': 0,
              'modestbranding': 1
            },
            events: {
              'onReady': onPlayerReady,
              'onStateChange': onPlayerStateChange
            }
          });
        }
      }
    }

    function playNextStream() {
      if (streams.length === 0) return;
      const nextIndex = (currentStreamIndex + 1) % streams.length;
      playStream(nextIndex);
    }

    function onPlayerReady(event) {
      event.target.playVideo();
    }

    function onPlayerStateChange(event) {
      // Handle player state changes if needed
    }

    function extractYouTubeId(url) {
      if (!url) return null;
      
      // Handle various YouTube URL formats
      const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(live\/))([^#\&\?]*).*/;
      const match = url.match(regExp);
      
      return (match && match[7].length === 11) ? match[7] : null;
    }

    function enterFullscreen() {
      const fullscreenMode = document.getElementById('fullscreenMode');
      const stream = streams[currentStreamIndex];
      const videoId = extractYouTubeId(stream.link);
      
      if (videoId) {
        fullscreenMode.style.display = 'block';
        
        if (fullscreenPlayer) {
          fullscreenPlayer.loadVideoById(videoId);
        } else {
          fullscreenPlayer = new YT.Player('fullscreenVideo', {
            height: '100%',
            width: '100%',
            videoId: videoId,
            playerVars: {
              'autoplay': 1,
              'controls': 1,
              'rel': 0,
              'modestbranding': 1
            }
          });
        }
      }
    }

    function exitFullscreen() {
      document.getElementById('fullscreenMode').style.display = 'none';
      if (fullscreenPlayer) {
        fullscreenPlayer.stopVideo();
      }
    }

    function goPage(page) {
      window.location.href = page;
    }

    function setActiveTab() {
      const tabs = document.querySelectorAll('.nav-tab');
      tabs.forEach(tab => {
        tab.classList.remove('active');
        if (tab.getAttribute('data-page') === 'live.html') {
          tab.classList.add('active');
        }
      });
    }

    function setupNavigation() {
      const navTabs = document.querySelectorAll('.nav-tab');
      navTabs.forEach(tab => {
        tab.addEventListener('click', function() {
          const page = this.getAttribute('data-page');
          goPage(page);
        });
      });
    }

    // Auto-refresh streams every 30 seconds to check for new streams
    function startAutoRefresh() {
      setInterval(() => {
        loadStreams();
      }, 30000);
    }

    document.addEventListener("DOMContentLoaded", function() {
      setActiveTab();
      setupNavigation();
      startAutoRefresh();
    });
  </script>
</body>
</html>